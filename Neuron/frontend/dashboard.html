<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURON | Mission Control</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Excitement meter now uses pure CSS -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap');

        :root {
            --glow-green: 0 0 20px rgba(34, 197, 94, 0.5), 0 0 40px rgba(34, 197, 94, 0.3);
            --glow-red: 0 0 20px rgba(239, 68, 68, 0.5), 0 0 40px rgba(239, 68, 68, 0.3);
            --glow-yellow: 0 0 20px rgba(234, 179, 8, 0.5), 0 0 40px rgba(234, 179, 8, 0.3);
            --glow-purple: 0 0 20px rgba(147, 51, 234, 0.5), 0 0 40px rgba(147, 51, 234, 0.3);
            --glow-orange: 0 0 20px rgba(249, 115, 22, 0.5), 0 0 40px rgba(249, 115, 22, 0.3);
            --glow-cyan: 0 0 20px rgba(6, 182, 212, 0.5), 0 0 40px rgba(6, 182, 212, 0.3);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            min-height: 100vh;
        }

        .font-orbitron {
            font-family: 'Orbitron', monospace;
        }

        .glow-green {
            box-shadow: var(--glow-green);
            border-color: #22c55e;
        }

        .glow-red {
            box-shadow: var(--glow-red);
            border-color: #ef4444;
        }

        .glow-yellow {
            box-shadow: var(--glow-yellow);
            border-color: #eab308;
        }

        .glow-purple {
            box-shadow: var(--glow-purple);
            border-color: #9333ea;
        }

        .glow-orange {
            box-shadow: var(--glow-orange);
            border-color: #f97316;
        }

        .glow-cyan {
            box-shadow: var(--glow-cyan);
            border-color: #06b6d4;
        }

        .card-enter {
            animation: cardFadeIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes cardFadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
                filter: blur(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                opacity: 1;
                box-shadow: 0 0 20px var(--glow-color, rgba(34, 197, 94, 0.5));
            }

            50% {
                opacity: 0.8;
                box-shadow: 0 0 40px var(--glow-color, rgba(34, 197, 94, 0.8)), 0 0 60px var(--glow-color, rgba(34, 197, 94, 0.4));
            }
        }

        .pulse-glow {
            animation: pulse-glow 1.5s ease-in-out infinite;
        }

        /* Enhanced LIVE indicator */
        @keyframes live-pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.3);
                opacity: 0.6;
            }
        }

        .live-pulse {
            animation: live-pulse 1s ease-in-out infinite;
        }

        /* Hot card effect for high excitement */
        @keyframes hot-glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
            }

            50% {
                box-shadow: 0 0 40px rgba(34, 197, 94, 0.8), 0 0 60px rgba(34, 197, 94, 0.4);
            }
        }

        .hot-card {
            animation: hot-glow 1s ease-in-out infinite;
        }

        /* Demo mode button animation */
        @keyframes demo-pulse {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .demo-mode-btn {
            background: linear-gradient(270deg, #f97316, #eab308, #22c55e, #06b6d4, #8b5cf6, #f97316);
            background-size: 400% 400%;
            animation: demo-pulse 3s ease infinite;
        }

        .scanline {
            background: repeating-linear-gradient(0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, 0.03) 2px,
                    rgba(0, 255, 255, 0.03) 4px);
            pointer-events: none;
        }

        .grid-bg {
            background-image:
                linear-gradient(rgba(6, 182, 212, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .status-dot {
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #0ea5e9;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #38bdf8;
        }

        .btn-action {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-action:hover::before {
            left: 100%;
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        /* ===== NEW IMPRESSIVE ANIMATIONS ===== */

        /* Animated data flow for pipeline */
        @keyframes dataFlow {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 200% 50%;
            }
        }

        .data-flow {
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(34, 211, 238, 0.3) 25%,
                    rgba(168, 85, 247, 0.5) 50%,
                    rgba(34, 211, 238, 0.3) 75%,
                    transparent 100%);
            background-size: 200% 100%;
            animation: dataFlow 2s linear infinite;
        }

        /* Glowing latency number */
        @keyframes latencyPulse {

            0%,
            100% {
                text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
                transform: scale(1);
            }

            50% {
                text-shadow: 0 0 30px rgba(34, 197, 94, 0.8), 0 0 60px rgba(34, 197, 94, 0.4);
                transform: scale(1.05);
            }
        }

        .latency-glow {
            animation: latencyPulse 1.5s ease-in-out infinite;
        }

        /* Processing wave animation */
        @keyframes processingWave {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .processing-wave::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: processingWave 1.5s ease-in-out infinite;
        }

        /* Kafka streaming dots */
        @keyframes streamDots {

            0%,
            20% {
                opacity: 0.3;
            }

            40% {
                opacity: 1;
            }

            60%,
            100% {
                opacity: 0.3;
            }
        }

        .stream-dot-1 {
            animation: streamDots 1.5s ease-in-out infinite;
        }

        .stream-dot-2 {
            animation: streamDots 1.5s ease-in-out 0.3s infinite;
        }

        .stream-dot-3 {
            animation: streamDots 1.5s ease-in-out 0.6s infinite;
        }

        /* Message slide in with bounce */
        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translateX(-50px) scale(0.9);
            }

            60% {
                transform: translateX(10px) scale(1.02);
            }

            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .message-enter {
            animation: messageSlide 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Glowing border for active elements */
        @keyframes borderGlow {

            0%,
            100% {
                border-color: rgba(34, 211, 238, 0.3);
            }

            50% {
                border-color: rgba(34, 211, 238, 0.8);
            }
        }

        .border-glow {
            animation: borderGlow 2s ease-in-out infinite;
        }

        /* Hero glow effect */
        .hero-glow {
            background: radial-gradient(ellipse at center, rgba(168, 85, 247, 0.15) 0%, transparent 70%);
        }

        /* Tech badge shimmer */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .shimmer-badge {
            background: linear-gradient(90deg,
                    rgba(249, 115, 22, 0.2) 0%,
                    rgba(249, 115, 22, 0.4) 50%,
                    rgba(249, 115, 22, 0.2) 100%);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-100 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============ ICON COMPONENTS ============
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current) {
                    ref.current.innerHTML = '';
                    const icon = lucide.createElement(lucide.icons[name]);
                    ref.current.appendChild(icon);
                }
            }, [name]);
            return <span ref={ref} className={`inline-flex ${className}`}></span>;
        };

        // ============ MAIN APP COMPONENT ============
        function MissionControl() {
            const [messages, setMessages] = useState([]);
            const [audioEnabled, setAudioEnabled] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [stats, setStats] = useState({ events: 0, touchdowns: 0, turnovers: 0 });
            const [excitementHistory, setExcitementHistory] = useState([]);
            const [currentLocale, setCurrentLocale] = useState('en-US');
            const [lastLatency, setLastLatency] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const feedRef = useRef(null);

            // Locale configurations
            const LOCALES = {
                'en-US': { flag: 'üá∫üá∏', name: 'American', style: 'Stats-focused NFL' },
                'pt-BR': { flag: 'üáßüá∑', name: 'Brazilian', style: 'GOOOOL energy!' },
                'en-GB': { flag: 'üá¨üáß', name: 'British', style: 'Dry & sarcastic' },
                'es-MX': { flag: 'üá≤üáΩ', name: 'Mexican', style: 'Andr√©s Cantor' },
                'en-AU': { flag: 'üá¶üá∫', name: 'Aussie', style: 'G\'day mate!' },
                'ja-JP': { flag: 'üáØüáµ', name: 'Japanese', style: 'Anime energy!' }
            };

            // SSE Connection
            useEffect(() => {
                const eventSource = new EventSource('https://neuron-api-582963349700.us-central1.run.app/stream');

                eventSource.onopen = () => {
                    setConnectionStatus('connected');
                    console.log('‚úÖ SSE Connected to Mission Control');
                };

                eventSource.addEventListener('debate', (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        const excitementScore = data.excitement_score || data.confidence * 100 || 50;
                        const newMessage = {
                            id: Date.now(),
                            content: data.content || data.answer || data.message || JSON.stringify(data),
                            agent: data.agent_id || 'SYSTEM',
                            timestamp: new Date().toLocaleTimeString(),
                            confidence: data.confidence || 0,
                            excitement: excitementScore,
                            type: getEventType(data.content || data.answer || '')
                        };

                        setMessages(prev => [newMessage, ...prev].slice(0, 50));
                        updateStats(newMessage.type);

                        // Update excitement history for graph
                        setExcitementHistory(prev => [
                            ...prev.slice(-19),
                            { time: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }).slice(0, 5), score: excitementScore }
                        ]);

                        if (audioEnabled && newMessage.content) {
                            speak(newMessage.content);
                        }
                    } catch (e) {
                        console.error('Parse error:', e);
                    }
                });

                eventSource.addEventListener('keepalive', () => {
                    // Keep connection alive
                });

                eventSource.onerror = () => {
                    setConnectionStatus('disconnected');
                    console.log('‚ùå SSE Disconnected');
                };

                return () => eventSource.close();
            }, [audioEnabled]);

            const getEventType = (content) => {
                const upper = content.toUpperCase();
                if (upper.includes('TOUCHDOWN')) return 'touchdown';
                if (upper.includes('PENALTY')) return 'penalty';
                if (upper.includes('INTERCEPTION')) return 'interception';
                if (upper.includes('FUMBLE')) return 'fumble';
                return 'default';
            };

            const updateStats = (type) => {
                setStats(prev => ({
                    events: prev.events + 1,
                    touchdowns: type === 'touchdown' ? prev.touchdowns + 1 : prev.touchdowns,
                    turnovers: (type === 'interception' || type === 'fumble') ? prev.turnovers + 1 : prev.turnovers
                }));
            };

            // speak function moved below handleSimulate with persona support

            const handleSimulate = async (type, team, description) => {
                const startTime = Date.now();
                setIsProcessing(true);
                try {
                    const response = await fetch('https://neuron-api-582963349700.us-central1.run.app/simulate_event', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type })
                    });
                    const agents = await response.json();
                    const latency = Date.now() - startTime;
                    setLastLatency(latency);
                    console.log(`üêù Swarm response in ${latency}ms:`, agents);

                    // Process each agent in the swarm
                    if (Array.isArray(agents)) {
                        // Agent A (Fan Agent) - render immediately
                        const homer = agents[0];
                        if (homer) {
                            const homerMessage = {
                                id: Date.now(),
                                content: homer.content,
                                agent: homer.name || 'Fan Agent üî•',
                                agent_id: homer.agent_id,
                                persona: homer.persona,
                                alignment: 'left',
                                timestamp: new Date().toLocaleTimeString(),
                                excitement: homer.excitement_score,
                                type: homer.event_type?.toLowerCase() || 'default',
                                locale: 'en-US'  // Fan Agent = American passionate style
                            };
                            setMessages(prev => [homerMessage, ...prev].slice(0, 50));
                            updateStats(homerMessage.type);

                            // Update excitement history
                            setExcitementHistory(prev => [
                                ...prev.slice(-19),
                                { time: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }).slice(0, 5), score: homer.excitement_score, agent: 'homer' }
                            ]);

                            // Speak The Homer with fanatic voice
                            if (audioEnabled) {
                                speak(homer.content, homer.persona);
                            }
                        }

                        // Agent B (Analyst Agent) - render after 6 seconds (no overlap)
                        const skeptic = agents[1];
                        if (skeptic) {
                            setTimeout(() => {
                                const skepticMessage = {
                                    id: Date.now() + 1,
                                    content: skeptic.content,
                                    agent: skeptic.name || 'Analyst Agent üßê',
                                    agent_id: skeptic.agent_id,
                                    persona: skeptic.persona,
                                    alignment: 'right',
                                    timestamp: new Date().toLocaleTimeString(),
                                    excitement: skeptic.excitement_score,
                                    type: skeptic.event_type?.toLowerCase() || 'default',
                                    locale: 'en-GB'  // Analyst Agent = British analytical style
                                };
                                setMessages(prev => [skepticMessage, ...prev].slice(0, 50));

                                // Update excitement history with skeptic score
                                setExcitementHistory(prev => [
                                    ...prev.slice(-19),
                                    { time: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }).slice(0, 5), score: skeptic.excitement_score, agent: 'skeptic' }
                                ]);

                                // Speak The Skeptic with analyst voice (only after Homer finishes)
                                if (audioEnabled) {
                                    speak(skeptic.content, skeptic.persona);
                                }
                            }, 6000);
                        }
                    }
                } catch (error) {
                    console.error('Failed to simulate:', error);
                    setLastLatency(null);
                } finally {
                    setIsProcessing(false);
                }
            };

            // Demo capability simulations
            const demoCapability = (capability) => {
                const demos = {
                    'object_permanence': {
                        agent: 'üß† Memory Module',
                        content: 'üìÇ CONTEXT RECALLED: User asked about Patrick Mahomes stats 2 hours ago. Retrieving... "Mahomes: 312 yds, 3 TD, 0 INT" ‚Äî Memory persists across server restarts via Firestore.',
                        type: 'system',
                        color: 'emerald'
                    },
                    'referee_bot': {
                        agent: 'üé¨ Referee Bot',
                        content: '‚öñÔ∏è RULING ANALYSIS: Reviewing video clip at 3:42... Detected: Defensive holding on #24. Cross-referencing NFL Rulebook Section 12.1.3... CONFIRMED: 5-yard penalty, automatic first down.',
                        type: 'referee',
                        color: 'yellow'
                    },
                    'cultural_routing': {
                        agent: 'ü¶é Chameleon Engine',
                        content: 'üåç LOCALE DETECTED: Brazil (pt-BR). Swapping personality matrix... "GOOOOOOL! QUE JOGADA ESPETACULAR!" ‚Äî Dynamic system instructions loaded.',
                        type: 'cultural',
                        color: 'purple'
                    },
                    'swarm_intelligence': {
                        agent: 'üêù Swarm Orchestrator',
                        content: '‚ö° MULTI-AGENT DEBATE INITIATED: The Homer (fanatic) vs The Skeptic (analyst). Each agent processes independently with distinct personality weights and voices.',
                        type: 'swarm',
                        color: 'green'
                    },
                    'circuit_breakers': {
                        agent: 'üõ°Ô∏è ValidatorAgent',
                        content: 'üö´ CONTENT BLOCKED: Detected potentially harmful content (toxicity score: 0.87). Pipeline halted. Regenerating with reinforced safety guidelines... ‚úÖ Clean response generated.',
                        type: 'blocked',
                        color: 'red'
                    }
                };

                const demo = demos[capability];
                if (demo) {
                    const message = {
                        id: Date.now(),
                        content: demo.content,
                        agent: demo.agent,
                        timestamp: new Date().toLocaleTimeString(),
                        type: demo.type,
                        demoColor: demo.color,
                        isDemo: true
                    };
                    setMessages(prev => [message, ...prev].slice(0, 50));
                    setStats(prev => ({ ...prev, events: prev.events + 1 }));

                    if (audioEnabled) {
                        speak(demo.content, 'analyst');
                    }
                }
            };

            // Audio queue to prevent overlapping
            let audioQueue = [];
            let isPlaying = false;

            const playNextInQueue = () => {
                if (audioQueue.length === 0) {
                    isPlaying = false;
                    return;
                }
                isPlaying = true;
                const { audioUrl, persona } = audioQueue.shift();
                const audio = new Audio(audioUrl);
                audio.onended = () => {
                    console.log('üé§ Finished ' + (persona || 'default') + ' voice');
                    playNextInQueue();
                };
                audio.onerror = () => playNextInQueue();
                audio.play();
                console.log('üé§ Playing ' + (persona || 'default') + ' voice');
            };

            // Updated speak function with persona support and queue
            const speak = async (text, persona = '') => {
                try {
                    const response = await fetch('https://neuron-api-582963349700.us-central1.run.app/speak', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: text.substring(0, 500), persona })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const audioUrl = URL.createObjectURL(blob);
                        audioQueue.push({ audioUrl, persona });
                        if (!isPlaying) {
                            playNextInQueue();
                        }
                        return;
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Cloud TTS unavailable, using browser fallback');
                }

                // Fallback to browser speechSynthesis (already queues automatically)
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = persona === 'fanatic' ? 1.3 : 0.9;
                    utterance.pitch = persona === 'fanatic' ? 1.2 : 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            };

            const getCardStyle = (type) => {
                switch (type) {
                    case 'touchdown': return 'glow-green border-green-500';
                    case 'penalty': return 'glow-red border-red-500';
                    case 'interception': return 'glow-yellow border-yellow-500';
                    case 'fumble': return 'glow-orange border-orange-500';
                    default: return 'glow-cyan border-cyan-500';
                }
            };

            return (
                <div className="h-screen flex flex-col">
                    {/* HEADER */}
                    <header className="bg-slate-950/80 backdrop-blur-sm border-b border-cyan-500/30 px-6 py-3">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-gradient-to-br from-cyan-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <span className="text-2xl">üß†</span>
                                </div>
                                <div>
                                    <h1 className="font-orbitron text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                                        NEURON MISSION CONTROL
                                    </h1>
                                    <p className="text-slate-400 text-xs">Confluent Kafka √ó Google Cloud Run √ó Gemini AI</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                {/* Animated Pipeline Status */}
                                {isProcessing && (
                                    <div className="flex items-center gap-2 px-3 py-2 bg-slate-800/80 rounded-lg border border-purple-500/40 overflow-hidden relative">
                                        <div className="absolute inset-0 data-flow"></div>
                                        <span className="stream-dot-1 text-orange-400">‚óè</span>
                                        <span className="stream-dot-2 text-purple-400">‚óè</span>
                                        <span className="stream-dot-3 text-cyan-400">‚óè</span>
                                        <span className="text-[10px] text-slate-300 font-mono relative z-10">Kafka ‚Üí Cloud Run ‚Üí Gemini</span>
                                    </div>
                                )}

                                {/* Latency Timer */}
                                <div className={`flex items-center gap-2 px-4 py-2 rounded-lg border ${lastLatency ? 'bg-gradient-to-r from-green-900/50 to-emerald-900/50 border-green-500/40' : 'bg-slate-800/50 border-slate-600/40'}`}>
                                    <span className="text-xs text-green-300 uppercase tracking-wide">Response</span>
                                    <span className={`text-xl font-orbitron text-green-400 ${lastLatency ? 'latency-glow' : ''}`}>{lastLatency ? 'Sub-second' : '--'}</span>
                                </div>

                                {/* Connection Status */}
                                <div className="flex items-center gap-2 px-3 py-2 bg-slate-800 rounded-lg border border-slate-700">
                                    <div className={`w-2 h-2 rounded-full status-dot ${connectionStatus === 'connected' ? 'bg-green-500' :
                                        connectionStatus === 'connecting' ? 'bg-yellow-500' : 'bg-red-500'
                                        }`}></div>
                                    <span className="text-xs font-medium uppercase tracking-wide">
                                        {connectionStatus}
                                    </span>
                                </div>

                                {/* Stats */}
                                <div className="flex gap-2">
                                    <div className="text-center px-3 py-1 bg-slate-800 rounded-lg border border-slate-700">
                                        <div className="text-xl font-orbitron text-cyan-400">{stats.events}</div>
                                        <div className="text-[10px] text-slate-400 uppercase">Events</div>
                                    </div>
                                    <div className="text-center px-3 py-1 bg-slate-800 rounded-lg border border-green-500/30">
                                        <div className="text-xl font-orbitron text-green-400">{stats.touchdowns}</div>
                                        <div className="text-[10px] text-slate-400 uppercase">Touchdowns</div>
                                    </div>
                                    <div className="text-center px-3 py-1 bg-slate-800 rounded-lg border border-yellow-500/30">
                                        <div className="text-xl font-orbitron text-yellow-400">{stats.turnovers}</div>
                                        <div className="text-[10px] text-slate-400 uppercase">Turnovers</div>
                                    </div>
                                </div>

                                {/* Tech Stack Badge */}
                                <div className="flex items-center gap-2 px-3 py-2 bg-slate-800/50 rounded-lg border border-orange-500/30">
                                    <span className="text-orange-400 text-sm">‚ö°</span>
                                    <span className="text-[10px] text-slate-300 font-medium">Kafka + Cloud Run + Gemini</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 grid grid-cols-3 gap-0 overflow-hidden">
                        {/* LEFT PANEL - LIVE FEED (2/3) */}
                        <div className="col-span-2 flex flex-col bg-slate-900/50 grid-bg">
                            <div className="px-6 py-4 border-b border-slate-700/50 bg-slate-900/80">
                                <h2 className="font-orbitron text-lg text-cyan-400 flex items-center gap-2">
                                    <span className="w-2 h-2 bg-cyan-400 rounded-full status-dot"></span>
                                    LIVE FEED
                                </h2>
                            </div>

                            {/* EXCITEMENT GRAPH */}
                            {excitementHistory.length > 0 && (
                                <div className="px-6 py-4 border-b border-slate-700/50 bg-slate-800/50">
                                    <div className="flex items-center justify-between mb-2">
                                        <h3 className="font-orbitron text-sm text-yellow-400 flex items-center gap-2">
                                            üìä EXCITEMENT METER
                                        </h3>
                                        <span className="text-2xl font-bold text-yellow-400">
                                            {excitementHistory.length > 0 ? excitementHistory[excitementHistory.length - 1].score : 0}
                                        </span>
                                    </div>
                                    {/* Simple CSS Excitement Bar */}
                                    <div className="w-full h-8 bg-slate-700 rounded-full overflow-hidden relative">
                                        <div
                                            className="h-full bg-gradient-to-r from-yellow-600 via-yellow-400 to-yellow-300 transition-all duration-500 ease-out rounded-full"
                                            style={{ width: `${excitementHistory.length > 0 ? excitementHistory[excitementHistory.length - 1].score : 0}%` }}
                                        ></div>
                                        <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-slate-900">
                                            {excitementHistory.length > 0 ? excitementHistory[excitementHistory.length - 1].score : 0}% HYPE
                                        </div>
                                    </div>
                                    {/* Mini bar history */}
                                    <div className="flex gap-1 mt-2 h-12 items-end">
                                        {excitementHistory.slice(-20).map((item, idx) => (
                                            <div
                                                key={idx}
                                                className="flex-1 bg-yellow-500/50 rounded-t transition-all duration-300"
                                                style={{ height: `${item.score}%` }}
                                                title={`${item.time}: ${item.score}`}
                                            ></div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div ref={feedRef} className="flex-1 overflow-y-auto p-6 space-y-4 relative">
                                <div className="absolute inset-0 scanline"></div>

                                {messages.length === 0 ? (
                                    <div className="flex flex-col items-center justify-center h-full text-slate-500">
                                        <div className="w-20 h-20 border-4 border-slate-700 border-t-cyan-500 rounded-full animate-spin mb-4"></div>
                                        <p className="font-orbitron">AWAITING TRANSMISSION...</p>
                                        <p className="text-sm mt-2">Use Operator Deck to trigger events</p>
                                    </div>
                                ) : (
                                    messages.map((msg) => (
                                        <div
                                            key={msg.id}
                                            className={`card-enter flex ${msg.alignment === 'right' ? 'justify-end' : 'justify-start'}`}
                                        >
                                            <div className={`max-w-[85%] ${msg.persona === 'fanatic'
                                                ? 'bg-gradient-to-br from-green-900/80 to-emerald-800/60 border-l-4 border-green-500'
                                                : msg.persona === 'analyst'
                                                    ? 'bg-gradient-to-bl from-blue-900/80 to-indigo-800/60 border-r-4 border-blue-500'
                                                    : `bg-slate-800/90 border-l-4 ${getCardStyle(msg.type)}`
                                                } backdrop-blur rounded-lg p-4`}>
                                                <div className="flex justify-between items-start mb-2 gap-4">
                                                    <div className="flex items-center gap-2">
                                                        <span className={`text-xs font-mono px-2 py-1 rounded ${msg.persona === 'fanatic'
                                                            ? 'bg-green-500/30 text-green-300'
                                                            : msg.persona === 'analyst'
                                                                ? 'bg-blue-500/30 text-blue-300'
                                                                : 'bg-slate-700 text-cyan-400'
                                                            }`}>
                                                            {msg.agent}
                                                        </span>
                                                        {msg.persona && (
                                                            <span className={`text-xs px-2 py-0.5 rounded-full font-bold uppercase ${msg.persona === 'fanatic'
                                                                ? 'bg-orange-500/30 text-orange-300'
                                                                : 'bg-purple-500/30 text-purple-300'
                                                                }`}>
                                                                {msg.persona === 'fanatic' ? 'üî• FANATIC' : 'üßê ANALYST'}
                                                            </span>
                                                        )}
                                                        {msg.locale && LOCALES[msg.locale] && (
                                                            <span className="text-lg" title={`${LOCALES[msg.locale].name} Style`}>
                                                                {LOCALES[msg.locale].flag}
                                                            </span>
                                                        )}
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        {msg.excitement && (
                                                            <span className={`text-xs font-bold px-2 py-1 rounded ${msg.excitement >= 80 ? 'bg-green-500/20 text-green-400' :
                                                                msg.excitement >= 60 ? 'bg-yellow-500/20 text-yellow-400' :
                                                                    msg.excitement >= 40 ? 'bg-orange-500/20 text-orange-400' :
                                                                        'bg-slate-600/20 text-slate-400'
                                                                }`}>
                                                                ‚ö° {msg.excitement}
                                                            </span>
                                                        )}
                                                        <span className="text-xs text-slate-500 font-mono">
                                                            {msg.timestamp}
                                                        </span>
                                                    </div>
                                                </div>
                                                <p className="text-slate-100 leading-relaxed">{msg.content}</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {/* RIGHT PANEL - OPERATOR DECK (1/3) */}
                        <div className="bg-slate-950 border-l border-slate-700/50 flex flex-col h-full max-h-screen">
                            <div className="px-6 py-4 border-b border-slate-700/50 bg-gradient-to-r from-purple-900/30 to-slate-950 flex-shrink-0">
                                <h2 className="font-orbitron text-lg text-purple-400 flex items-center gap-2">
                                    <span className="text-xl">‚öôÔ∏è</span>
                                    OPERATOR DECK
                                </h2>
                            </div>

                            <div className="flex-1 p-6 space-y-6 overflow-y-auto min-h-0">
                                {/* AUDIO TOGGLE */}
                                <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-3">
                                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${audioEnabled ? 'bg-green-500/20 text-green-400' : 'bg-slate-700 text-slate-400'
                                                }`}>
                                                <span className="text-xl">{audioEnabled ? 'üîä' : 'üîá'}</span>
                                            </div>
                                            <div>
                                                <div className="font-medium">Text-to-Speech</div>
                                                <div className="text-xs text-slate-400">Announce events audibly</div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => setAudioEnabled(!audioEnabled)}
                                            className={`relative w-14 h-8 rounded-full transition-colors ${audioEnabled ? 'bg-green-500' : 'bg-slate-600'
                                                }`}
                                        >
                                            <div className={`absolute top-1 w-6 h-6 bg-white rounded-full shadow transition-transform ${audioEnabled ? 'translate-x-7' : 'translate-x-1'
                                                }`}></div>
                                        </button>
                                    </div>
                                </div>

                                {/* KEY CAPABILITIES - SIMPLIFIED FOR DEMO */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-indigo-900/30 rounded-xl p-4 border border-indigo-500/30">
                                    <h3 className="font-orbitron text-sm text-indigo-400 mb-3 uppercase tracking-wider flex items-center gap-2">
                                        üöÄ Key Capabilities
                                        <span className="text-[10px] text-slate-500 font-normal lowercase">(click to demo)</span>
                                    </h3>
                                    <div className="space-y-2 text-xs">
                                        {/* KAFKA REPLAY - Featured */}
                                        <button
                                            onClick={() => {
                                                const replayMessage = {
                                                    id: Date.now(),
                                                    content: '‚è™ KAFKA REPLAY: Rewinding event log to last touchdown... Found event at offset 47293. Deterministically replaying game state. This is the power of Kafka as a replay log.',
                                                    agent: 'üì° Kafka Replay Engine',
                                                    timestamp: new Date().toLocaleTimeString(),
                                                    type: 'system',
                                                    isDemo: true
                                                };
                                                setMessages(prev => [replayMessage, ...prev].slice(0, 50));
                                                setStats(prev => ({ ...prev, events: prev.events + 1 }));
                                            }}
                                            className="w-full flex items-start gap-2 p-3 bg-orange-900/30 rounded-lg border border-orange-500/50 hover:bg-orange-900/50 transition-all cursor-pointer text-left"
                                        >
                                            <span className="text-lg">‚è™</span>
                                            <div className="flex-1">
                                                <div className="font-semibold text-orange-400">Kafka Event Replay</div>
                                                <div className="text-slate-400">Deterministic re-run from any offset</div>
                                            </div>
                                            <span className="text-orange-400 text-[10px] font-bold">‚òÖ CONFLUENT</span>
                                        </button>

                                        {/* Object Permanence */}
                                        <button
                                            onClick={() => demoCapability('object_permanence')}
                                            className="w-full flex items-start gap-2 p-2 bg-slate-800/50 rounded-lg hover:bg-emerald-900/30 hover:border-emerald-500/50 border border-transparent transition-all cursor-pointer text-left"
                                        >
                                            <span className="text-lg">üß†</span>
                                            <div className="flex-1">
                                                <div className="font-semibold text-emerald-400">Object Permanence</div>
                                                <div className="text-slate-400">Context persists via Firestore</div>
                                            </div>
                                            <span className="text-emerald-400/50 text-[10px]">‚ñ∂ Try</span>
                                        </button>

                                        {/* Circuit Breakers */}
                                        <button
                                            onClick={() => demoCapability('circuit_breakers')}
                                            className="w-full flex items-start gap-2 p-2 bg-slate-800/50 rounded-lg hover:bg-red-900/30 hover:border-red-500/50 border border-transparent transition-all cursor-pointer text-left"
                                        >
                                            <span className="text-lg">üõ°Ô∏è</span>
                                            <div className="flex-1">
                                                <div className="font-semibold text-red-400">Circuit Breakers</div>
                                                <div className="text-slate-400">Content validation blocks toxic output</div>
                                            </div>
                                            <span className="text-red-400/50 text-[10px]">‚ñ∂ Try</span>
                                        </button>
                                    </div>
                                </div>

                                {/* ARCHITECTURE DIAGRAM */}
                                <div className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 rounded-xl p-4 border border-cyan-500/30">
                                    <h3 className="font-orbitron text-sm text-cyan-400 mb-3 uppercase tracking-wider flex items-center gap-2">
                                        üìê System Architecture
                                    </h3>
                                    <div className="space-y-3 text-xs">
                                        {/* Data Layer */}
                                        <div className="flex items-center gap-2">
                                            <div className="w-8 h-8 bg-orange-500/20 rounded flex items-center justify-center">
                                                <span className="text-sm">üì°</span>
                                            </div>
                                            <div className="flex-1">
                                                <div className="font-semibold text-orange-400">Confluent Kafka</div>
                                                <div className="text-slate-500">Event Stream + Replay Log</div>
                                            </div>
                                        </div>

                                        {/* Arrow */}
                                        <div className="flex justify-center">
                                            <div className="w-0.5 h-4 bg-gradient-to-b from-orange-500 to-purple-500"></div>
                                        </div>

                                        {/* Processing Layer */}
                                        <div className="flex items-center gap-2">
                                            <div className="w-8 h-8 bg-purple-500/20 rounded flex items-center justify-center">
                                                <span className="text-sm">üß†</span>
                                            </div>
                                            <div className="flex-1">
                                                <div className="font-semibold text-purple-400">Cloud Run (Swarm AI)</div>
                                                <div className="text-slate-500">Multi-Agent Debate Engine</div>
                                            </div>
                                        </div>

                                        {/* Branch */}
                                        <div className="flex justify-center gap-8">
                                            <div className="w-0.5 h-4 bg-gradient-to-b from-purple-500 to-green-500"></div>
                                            <div className="w-0.5 h-4 bg-gradient-to-b from-purple-500 to-blue-500"></div>
                                        </div>

                                        {/* Output Layers */}
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="flex items-center gap-2 bg-slate-800/50 p-2 rounded">
                                                <div className="w-6 h-6 bg-green-500/20 rounded flex items-center justify-center">
                                                    <span className="text-xs">üé§</span>
                                                </div>
                                                <div>
                                                    <div className="font-semibold text-green-400 text-[10px]">Cloud TTS</div>
                                                    <div className="text-slate-500 text-[9px]">Voice Gen</div>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2 bg-slate-800/50 p-2 rounded">
                                                <div className="w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center">
                                                    <span className="text-xs">üî•</span>
                                                </div>
                                                <div>
                                                    <div className="font-semibold text-blue-400 text-[10px]">Firebase</div>
                                                    <div className="text-slate-500 text-[9px]">Hosting</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Footer */}
                                        <div className="mt-2 pt-2 border-t border-slate-700/50 text-center text-slate-500">
                                            Real-time SSE streaming to dashboard
                                        </div>
                                    </div>
                                </div >

                                {/* LOCALE SELECTOR */}
                                < div >
                                    <h3 className="font-orbitron text-sm text-slate-400 mb-3 uppercase tracking-wider">
                                        üåç Commentary Style
                                    </h3>
                                    <div className="grid grid-cols-3 gap-2">
                                        {Object.entries(LOCALES).map(([code, locale]) => (
                                            <button
                                                key={code}
                                                onClick={() => setCurrentLocale(code)}
                                                className={`p-2 rounded-lg text-center transition-all ${currentLocale === code
                                                    ? 'bg-purple-600 border-2 border-purple-400 shadow-lg shadow-purple-500/30'
                                                    : 'bg-slate-800 border border-slate-700 hover:bg-slate-700'
                                                    }`}
                                            >
                                                <div className="text-xl">{locale.flag}</div>
                                                <div className="text-xs font-medium mt-1">{locale.name}</div>
                                            </button>
                                        ))}
                                    </div>
                                    <div className="mt-2 text-center text-xs text-purple-400">
                                        Current: {LOCALES[currentLocale].style}
                                    </div>
                                </div>

                                {/* ACTION GRID */}
                                <div>
                                    <h3 className="font-orbitron text-sm text-slate-400 mb-4 uppercase tracking-wider">
                                        Quick Actions
                                    </h3>

                                    {/* DEMO MODE - One Click */}
                                    <button
                                        disabled={isProcessing}
                                        onClick={async () => {
                                            // Run 2 events with proper spacing for voice to complete
                                            const scenarios = [
                                                { event: 'TOUCHDOWN', team: 'Kansas City Chiefs', star: 'Travis Kelce' },
                                                { event: 'INTERCEPTION', team: 'Philadelphia Eagles', star: 'Jalen Hurts' }
                                            ];
                                            for (let i = 0; i < scenarios.length; i++) {
                                                const s = scenarios[i];
                                                await handleSimulate(s.event, s.team, `${s.star} makes the play!`);
                                                // Wait 12 seconds between events (6s for each agent to speak)
                                                if (i < scenarios.length - 1) {
                                                    await new Promise(r => setTimeout(r, 12000));
                                                }
                                            }
                                        }}
                                        className={`w-full rounded-xl p-5 mb-4 text-center font-bold text-xl border-2 transition-all ${isProcessing
                                            ? 'bg-slate-700 border-slate-500 text-slate-400 cursor-wait'
                                            : 'demo-mode-btn text-white border-white/30 hover:border-white/60 hover:scale-105'
                                            }`}
                                    >
                                        {isProcessing ? (
                                            <span className="flex items-center justify-center gap-3">
                                                <span className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                                                Processing via Kafka ‚Üí Cloud Run ‚Üí Gemini...
                                            </span>
                                        ) : (
                                            'üöÄ RUN DEMO ‚Äî Watch AI Agents Debate'
                                        )}
                                    </button>

                                    <div className="grid grid-cols-2 gap-3">
                                        {/* TD Chiefs */}
                                        <button
                                            onClick={() => handleSimulate('TOUCHDOWN', 'Kansas City Chiefs', 'Mahomes finds Kelce for the score!')}
                                            className="btn-action bg-gradient-to-br from-red-600 to-yellow-700 hover:from-red-500 hover:to-yellow-600 text-white rounded-xl p-4 text-left border border-red-500/30"
                                        >
                                            <div className="text-2xl mb-2">üèà</div>
                                            <div className="font-bold">TD CHIEFS</div>
                                            <div className="text-xs opacity-80">KC scores!</div>
                                        </button>

                                        {/* TD Eagles */}
                                        <button
                                            onClick={() => handleSimulate('TOUCHDOWN', 'Philadelphia Eagles', 'Hurts scrambles in for the score!')}
                                            className="btn-action bg-gradient-to-br from-green-700 to-slate-700 hover:from-green-600 hover:to-slate-600 text-white rounded-xl p-4 text-left border border-green-500/30"
                                        >
                                            <div className="text-2xl mb-2">ü¶Ö</div>
                                            <div className="font-bold">TD EAGLES</div>
                                            <div className="text-xs opacity-80">Philly scores!</div>
                                        </button>

                                        {/* TD 49ers */}
                                        <button
                                            onClick={() => handleSimulate('TOUCHDOWN', 'San Francisco 49ers', 'McCaffrey punches it in!')}
                                            className="btn-action bg-gradient-to-br from-red-700 to-yellow-600 hover:from-red-600 hover:to-yellow-500 text-white rounded-xl p-4 text-left border border-red-500/30"
                                        >
                                            <div className="text-2xl mb-2">üî¥</div>
                                            <div className="font-bold">TD 49ERS</div>
                                            <div className="text-xs opacity-80">San Fran scores!</div>
                                        </button>

                                        {/* TD Cowboys */}
                                        <button
                                            onClick={() => handleSimulate('TOUCHDOWN', 'Dallas Cowboys', 'CeeDee Lamb in the end zone!')}
                                            className="btn-action bg-gradient-to-br from-blue-800 to-slate-600 hover:from-blue-700 hover:to-slate-500 text-white rounded-xl p-4 text-left border border-blue-500/30"
                                        >
                                            <div className="text-2xl mb-2">‚≠ê</div>
                                            <div className="font-bold">TD COWBOYS</div>
                                            <div className="text-xs opacity-80">Dallas scores!</div>
                                        </button>

                                        {/* Interception */}
                                        <button
                                            onClick={() => handleSimulate('INTERCEPTION', 'Defense', 'Ball picked off at the 40 yard line!')}
                                            className="btn-action bg-gradient-to-br from-yellow-600 to-yellow-800 hover:from-yellow-500 hover:to-yellow-700 text-white rounded-xl p-4 text-left border border-yellow-500/30"
                                        >
                                            <div className="text-2xl mb-2">üôå</div>
                                            <div className="font-bold">INT</div>
                                            <div className="text-xs opacity-80">Turnover!</div>
                                        </button>

                                        {/* Fumble */}
                                        <button
                                            onClick={() => handleSimulate('FUMBLE', 'Offense', 'The ball is loose! Defense recovers!')}
                                            className="btn-action bg-gradient-to-br from-orange-600 to-orange-800 hover:from-orange-500 hover:to-orange-700 text-white rounded-xl p-4 text-left border border-orange-500/30"
                                        >
                                            <div className="text-2xl mb-2">üí•</div>
                                            <div className="font-bold">FUMBLE</div>
                                            <div className="text-xs opacity-80">Ball on the ground!</div>
                                        </button>

                                        {/* Penalty */}
                                        <button
                                            onClick={() => handleSimulate('PENALTY', 'Offense', 'Pass interference, 15 yard penalty.')}
                                            className="btn-action bg-gradient-to-br from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white rounded-xl p-4 text-left border border-red-500/30"
                                        >
                                            <div className="text-2xl mb-2">üö©</div>
                                            <div className="font-bold">PENALTY</div>
                                            <div className="text-xs opacity-80">Flag on the play</div>
                                        </button>

                                        {/* Field Goal */}
                                        <button
                                            onClick={() => handleSimulate('FIELD_GOAL', 'Kicker', '52-yard field goal attempt is GOOD!')}
                                            className="btn-action bg-gradient-to-br from-cyan-600 to-cyan-800 hover:from-cyan-500 hover:to-cyan-700 text-white rounded-xl p-4 text-left border border-cyan-500/30"
                                        >
                                            <div className="text-2xl mb-2">üéØ</div>
                                            <div className="font-bold">FIELD GOAL</div>
                                            <div className="text-xs opacity-80">3 points!</div>
                                        </button>
                                    </div>
                                </div>

                                {/* SYSTEM INFO */}
                                <div className="mt-auto pt-6 border-t border-slate-700/50">
                                    <div className="text-xs text-slate-500 space-y-1 font-mono">
                                        <div className="flex justify-between">
                                            <span>API:</span>
                                            <span className="text-cyan-400">Cloud Run</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>SSE:</span>
                                            <span className="text-cyan-400">/stream</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>TTS:</span>
                                            <span className="text-green-400">Google Cloud</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* FOOTER */}
                    <footer className="bg-slate-950 border-t border-slate-700/50 px-6 py-2">
                        <div className="flex justify-between items-center text-xs text-slate-500">
                            <span>NEURON SYSTEMS v1.0.0</span>
                            <span className="font-mono">SESSION: {Date.now().toString(36).toUpperCase()}</span>
                            <span>üîí SECURE CHANNEL</span>
                        </div>
                    </footer>
                </div>
            );
        }

        // ============ RENDER APP ============
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MissionControl />);
    </script>
</body>

</html>